import 'package:flutter/material.dart';
import '../models/place.dart';

// -----------------------------------------------------------------------------
// SERVIÇOS MOCKADOS (Simulando API, Firebase Auth e Firestore)
// -----------------------------------------------------------------------------

// Serviço para simular a Autenticação Firebase
class AuthService {
  // Usuário mockado para simulação de login
  String? currentUserId;

  Future<bool> signIn(String email, String password) async {
    // Lógica real: await FirebaseAuth.instance.signInWithEmailAndPassword(...)
    await Future.delayed(const Duration(seconds: 1));
    if (email.contains('@') && password.length >= 6) {
      currentUserId = 'user_abc123'; // Simula login bem-sucedido
      return true;
    }
    return false;
  }

  Future<bool> register(String email, String password) async {
    // Lógica real: await FirebaseAuth.instance.createUserWithEmailAndPassword(...)
    await Future.delayed(const Duration(seconds: 1));
    if (email.contains('@') && password.length >= 6) {
      return true;
    }
    return false;
  }

  Future<void> signOut() async {
    // Lógica real: await FirebaseAuth.instance.signOut()
    await Future.delayed(const Duration(milliseconds: 500));
    currentUserId = null;
  }
}

// Serviço para simular o Consumo de API REST (ex: NASA APOD, Open Notify, etc.)
class ApiService {
  Future<List<Observacao>> fetchEventosAstronomicos() async {
    // Lógica real: final response = await http.get(Uri.parse('URL_DA_API'));
    // Aqui, retorna dados mockados para simulação
    await Future.delayed(const Duration(seconds: 2));
    return [
      Observacao(
          id: '1',
          nome: 'Superlua de Sangue',
          descricao: 'Fenômeno raro de eclipse lunar total.',
          urlImagem:
              'https://placehold.co/600x400/0000FF/FFFFFF?text=Lua'),
      Observacao(
          id: '2',
          nome: 'Chuva de Meteoros Perseidas',
          descricao: 'Pico de atividade com alta taxa de meteoros por hora.',
          urlImagem:
              'https://placehold.co/600x400/FF0000/FFFFFF?text=Meteoros'),
      Observacao(
          id: '3',
          nome: 'Galáxia de Andrômeda',
          descricao: 'A galáxia mais próxima da Via Láctea, visível a olho nu.',
          urlImagem:
              'https://placehold.co/600x400/00FF00/FFFFFF?text=Andrômeda'),
    ];
  }
}

// Serviço para simular Persistência de Dados no Firestore
class FirestoreService {
  // Coleção local para simular o Firestore (simplicidade de arquivo único)
  final List<Observacao> _favoritosMock = [];

  Future<void> saveFavorite(String userId, Observacao obs) async {
    // Lógica real: await FirebaseFirestore.instance.collection('users/$userId/favoritos').doc(obs.id).set(obs.toMap());
    await Future.delayed(const Duration(milliseconds: 500));
    if (!_favoritosMock.any((e) => e.id == obs.id)) {
      _favoritosMock.add(obs);
      print('Firestore Mock: Favorito salvo para $userId: ${obs.nome}');
    }
  }

  Future<List<Observacao>> getFavorites(String userId) async {
    // Lógica real: final snapshot = await FirebaseFirestore.instance.collection('users/$userId/favoritos').get();
    await Future.delayed(const Duration(milliseconds: 500));
    // Retorna uma cópia para evitar modificação externa
    return List.from(_favoritosMock);
  }
}

// Serviço para simular Notificações (configuração local)
class NotificationService {
  // Lógica real: FlutterLocalNotificationsPlugin() para notificações locais.
  // Lógica Push: Firebase Messaging para notificações push.

  Future<void> initialize() async {
    // Lógica de inicialização do plugin de notificação
    print('Notificações inicializadas (Conceitual)');
  }

  // Simula o recebimento e exibição de uma notificação
  Future<void> showPushNotification(String title, String body) async {
    // Lógica real: plugin.show(...)
    print('NOTIFICAÇÃO PUSH SIMULADA: $title - $body');
  }

  // Simula agendamento de notificação local (para um evento astronômico futuro)
  Future<void> scheduleLocalNotification(String title, DateTime scheduleTime) async {
    // Lógica real: plugin.schedule(...)
    print('NOTIFICAÇÃO LOCAL AGENDADA: $title para $scheduleTime');
  }
}